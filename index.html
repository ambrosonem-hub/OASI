<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modulo Ordine di Servizio â€” Web</title>
  <style>
    /* --- [STILI ESISTENTI INVARIATI] --- */
    :root {
      --max-width: 980px;
      --gap: 12px;
      --accent: #0b67ff;
    }
    body {
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: #f5f7fb;
      color: #1f2937;
      padding: 24px;
      display: flex;
      justify-content: center;
      flex-direction: column;
      align-items: center;
    }
    .container {width: 100%;max-width: var(--max-width);background: #fff;border-radius: 12px;box-shadow: 0 6px 24px rgba(20, 30, 60, 0.08);padding: 20px;}
    h1 {font-size: 20px;margin: 0 0 8px;}
    p.lead {margin: 0 0 18px;color: #475569;}
    form {display: grid;grid-template-columns: 1fr 320px;gap: 18px;}
    .panel {background: #fbfdff;border: 1px solid #e6eefb;padding: 12px;border-radius: 8px;}
    label {display: block;font-size: 13px;font-weight: 600;margin-bottom: 6px;}
    .field {margin-bottom: 12px;}
    select,input[type="text"],input[type="number"],textarea {width: 100%;padding: 8px;border: 1px solid #d1d9e6;border-radius: 6px;font-size: 14px;box-sizing: border-box;}
    textarea {min-height: 80px;resize: vertical;}
    .small {font-size: 13px;color: #475569;}
    .controls {display: flex;gap: 8px;align-items: center;}
    .full {grid-column: 1/-1;}
    .btn {background: var(--accent);color: #fff;padding: 8px 12px;border-radius: 8px;border: none;cursor: pointer;}
    .btn.secondary {background: #fff;color: var(--accent);border: 1px solid #cfe0ff;}
    .summary {background: #fff;padding: 12px;border-radius: 8px;border: 1px solid #eef2ff;}
    table {width: 100%;border-collapse: collapse;}
    td,th {padding: 8px;text-align: left;border-bottom: 1px solid #f1f5f9;}
    .right {text-align: right;}
    .muted {color: #6b7280;font-size: 13px;}
    .error {color: #b91c1c;font-weight: 600;}
    .logo-container {text-align: center;margin-bottom: 10px;}
    .logo-container img {max-width: 177px;max-height: 118px;height: auto;}
    .header-info {text-align: center;font-size: 13px;line-height: 1.2;margin-bottom: 20px;}
    .header-info .title {font-size: 16px;font-weight: bold;margin-bottom: 5px;}
    .firma-canvas {border: 1px solid #000;cursor: crosshair;background-color: #fff;width: 100%;max-width: 300px;height: 150px;box-sizing: border-box;display: block;margin-top: 5px;}
    .firma-canvas-container {margin-bottom: 15px;}
    .firme-container {display: flex;flex-wrap: wrap;gap: 20px;justify-content: space-between;width: 100%;margin-top: 15px;}
    .firme-container > div {flex: 1 1 300px;}
    .firma-canvas-container button {margin-top: 5px;}
    @media (max-width: 900px) {form {grid-template-columns: 1fr;}.firme-container {flex-direction: column;}.firma-canvas {max-width: 100%;}}
    @media print {
      @page {size: A4 portrait;margin: 15mm;}
      body {padding: 0;background: #fff;-webkit-print-color-adjust: exact;print-color-adjust: exact;}
      .container {width: 100%;max-width: 100%;box-shadow: none;border-radius: 0;padding: 0;display: block;}
      .btn, #calc, #reset, #exportJson, #print, .firma-canvas-container button, .small.muted {display: none !important;}
      .firma-canvas {display: none !important;}
      .firma-stampa {border: 1px solid #000;width: 300px;height: 150px;}
      .panel, .firme-container > div {padding: 0;border: none;}
      input, textarea, select {border: none;padding: 0;background: transparent;}
      form {display: block;}
      .header-info {margin-bottom: 10px;}
      h1 {font-size: 16px;margin: 0;}
      .logo-container img {max-width: 120px;max-height: 80px;}
      .summary {border: none;padding: 0;}
      /* nascondi input indirizzo in stampa */
      input#indirizzo {display: none !important;}
      #indirizzo-stampa {display: block !important;margin-top: 5px;}
    }
  </style>
</head>
<body>
<div class="container" role="main">
  <div class="logo-container">
    <img src="logo.jpg" alt="Logo Azienda" />
  </div>
  <div class="header-info">
    <div class="title">Sede Legale:</div>
    <div>Via Municipio, n. 14 - 83040 Fontanarosa (AV)</div>
    <div>Info â€“ 082545553</div>
    <div>Mail - irpinialogistica@gmail.com</div>
    <div>PEC irpinialogistica@pec.it</div>
    <div>C.F. / Partita IVA 03196380640</div>
  </div>
  <h1 style="text-align:center;">ORDINE DI SERVIZIO</h1>
  <form id="moduloForm" autocomplete="off">
    <div>
      <div class="panel">
        <!-- altri campi invariati -->
        <div class="field">
          <label for="progetto">Progetto</label>
          <select id="progetto" name="PROGETTO"></select>
        </div>
        <div class="field">
          <label for="struttura">Struttura</label>
          <select id="struttura" name="STRUTTURA"><option>SELEZIONARE</option></select>
        </div>
        <div class="field">
          <label for="ente">Ente</label>
          <select id="ente" name="ENTE"><option>SELEZIONARE</option></select>
        </div>
        <div class="field">
          <label for="indirizzo">Indirizzo</label>
          <input id="indirizzo" name="INDIRIZZO" type="text" placeholder="Via, Piazza, etc." />
          <span id="indirizzo-stampa" style="display:none;"></span>
        </div>
        <!-- resto invariato... -->
      </div>
    </div>
    <!-- pannello riepilogo + firme invariati -->
  </form>
</div>
<script>
  let dati = [];
  fetch("enti_strutture.json")
    .then(r => r.ok ? r.json() : Promise.reject())
    .then(json => { dati = json; popolaProgetti(); aggiornaCascata(); })
    .catch(() => {
      dati = [
        {"Progetto":"SAI-A01","Struttura":"AVELLINO","Ente":"PERCORSI","Indirizzo":"Via Roma 10, Avellino"},
        {"Progetto":"SAI-A01","Struttura":"AVELLINO","Ente":"AIC","Indirizzo":"Via Roma 15, Avellino"},
        {"Progetto":"SAI-A02","Struttura":"BENEVENTO","Ente":"PERCORSI","Indirizzo":"Corso Garibaldi 25, Benevento"}
      ];
      popolaProgetti(); aggiornaCascata();
    });

  function popolaProgetti(){
    const progettoSelect = document.getElementById("progetto");
    progettoSelect.innerHTML = "<option value=''>SELEZIONARE</option>";
    [...new Set(dati.map(d=>d.Progetto))].forEach(p=>{
      progettoSelect.innerHTML += `<option value="${p}">${p}</option>`;
    });
  }

  // gestione cascata
  const progettoEl = document.getElementById("progetto");
  const strutturaEl = document.getElementById("struttura");
  const enteEl = document.getElementById("ente");

  progettoEl.addEventListener("change", e=>{
    strutturaEl.innerHTML = "<option value=''>SELEZIONARE</option>";
    enteEl.innerHTML = "<option value=''>SELEZIONARE</option>";
    document.getElementById("indirizzo").value = "";
    const strutture = [...new Set(dati.filter(d=>d.Progetto===e.target.value).map(d=>d.Struttura))];
    strutture.forEach(s=> strutturaEl.innerHTML += `<option value="${s}">${s}</option>`);
  });

  strutturaEl.addEventListener("change", e=>{
    enteEl.innerHTML = "<option value=''>SELEZIONARE</option>";
    const enti = [...new Set(dati.filter(d=>d.Progetto===progettoEl.value && d.Struttura===e.target.value).map(d=>d.Ente))];
    enti.forEach(en=> enteEl.innerHTML += `<option value="${en}">${en}</option>`);
  });

  // ðŸ”‘ qui la modifica per indirizzi multipli
  enteEl.addEventListener("change", e=>{
    const progettoVal = progettoEl.value;
    const strutturaVal = strutturaEl.value;
    const records = dati.filter(d=> d.Progetto===progettoVal && d.Struttura===strutturaVal && d.Ente===e.target.value);

    const indirizzoContainer = document.getElementById("indirizzo").parentNode;
    const oldEl = document.getElementById("indirizzo");

    if(records.length > 1){
      const sel = document.createElement("select");
      sel.id = "indirizzo"; sel.name = "INDIRIZZO";
      records.forEach(r=>{
        const opt = document.createElement("option");
        opt.value = r.Indirizzo; opt.textContent = r.Indirizzo;
        sel.appendChild(opt);
      });
      indirizzoContainer.replaceChild(sel, oldEl);
    } else {
      const inp = document.createElement("input");
      inp.type = "text"; inp.id = "indirizzo"; inp.name = "INDIRIZZO";
      inp.placeholder = "Via, Piazza, etc.";
      inp.value = records[0] ? records[0].Indirizzo : "";
      indirizzoContainer.replaceChild(inp, oldEl);
    }
  });

  // ... resto script (calcoli, firme, stampa, esporta JSON) invariato ...
</script>
</body>
</html>
