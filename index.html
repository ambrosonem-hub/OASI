<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modulo Ordine di Servizio — Web</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
      line-height: 1.4;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 { margin-top: 0; font-size: 20px; }
    .header-block { display: flex; align-items: center; margin-bottom: 20px; }
    .header-block img { width: 80px; margin-right: 20px; }
    .header-info { font-size: 12px; }
    form { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
    .panel {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      background: #fafafa;
    }
    .panel h3 { margin-top: 0; font-size: 16px; }
    label { font-weight: bold; display: block; margin-top: 8px; }
    input, select, textarea {
      width: 100%; padding: 6px; margin-top: 4px;
      border: 1px solid #ccc; border-radius: 4px; font-size: 14px;
    }
    .row { display: flex; gap: 10px; }
    .row > div { flex: 1; }
    .summary table { width: 100%; border-collapse: collapse; }
    .summary th, .summary td {
      text-align: left; padding: 6px; border-bottom: 1px solid #ddd;
    }
    .summary .right { text-align: right; }
    .btn {
      background: #1976d2; color: #fff;
      border: none; padding: 8px 16px;
      border-radius: 6px; cursor: pointer; font-size: 14px;
    }
    .btn.secondary { background: #555; }
    .btn:disabled { opacity: 0.5; cursor: default; }
    .muted { font-size: 12px; color: #666; }
    .firme-container { display: flex; gap: 20px; margin-top: 20px; flex-wrap: wrap; }
    .firma-canvas-container { flex: 1; min-width: 250px; }
    .firma-canvas {
      border: 1px dashed #999;
      border-radius: 4px;
      width: 100%; height: 150px;
      cursor: crosshair;
    }
    @media print {
      @page { size: A4 portrait; margin: 10mm; }
      body { padding: 0; background: #fff; margin: 0; }
      .container {
        max-width: 100%;
        box-shadow: none;
        border-radius: 0;
        padding: 0;
        transform: scale(0.60);
        transform-origin: top left;
        display: block;
      }
      form { grid-template-columns: 1fr; gap: 10px; }
      .panel { padding: 8px; }
      h1 { font-size: 16pt; text-align: center; }
      .header-block { justify-content: center; }
      .header-block img { width: 100px; max-width: none; }
      .header-info { font-size: 10pt; }
      p.lead, label, .small, td, th, input, textarea, select { font-size: 10pt; }
      .field { margin-bottom: 8px; }
      .btn, #calc, #reset, #exportJson, #print, .firma-canvas-container button {
        display: none !important;
      }
      .firma-canvas {
        border: 1px solid #000;
        width: 100% !important;
        height: 75px !important;
      }
      .firme-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 10px;
      }
      .firma-canvas-container { page-break-inside: avoid; margin-top: 10px; }
    }
  </style>
</head>
<body>
<div class="container" role="main">
  <div class="header-block">
    <img src="1ok_luca modello.jpg" alt="Logo Aziendale" />
    <div class="header-info">
      <div class="title">Sede Legale:</div>
      <div>Via Municipio, n. 14 - 83040 Fontanarosa (AV)</div>
      <div>Info – 082545553</div>
      <div>Mail - irpinialogistica@gmail.com</div>
      <div>PEC irpinialogistica@pec.it</div>
      <div>C.F. / Partita IVA 03196380640</div>
    </div>
  </div>

  <h1 style="text-align:center;">ORDINE DI SERVIZIO</h1>

  <form id="moduloForm" autocomplete="off">
    <div class="left-panel">
      <div class="panel">
        <label>Progetto
          <select id="progetto" name="PROGETTO">
            <option value="">Seleziona progetto</option>
            <option value="SAI IRPINIA">SAI IRPINIA</option>
            <option value="PROGETTO ARCOBALENO">PROGETTO ARCOBALENO</option>
            <option value="SIPROIMI">SIPROIMI</option>
          </select>
        </label>
        <label>Struttura
          <select id="struttura" name="STRUTTURA">
            <option value="">Seleziona struttura</option>
          </select>
        </label>
        <label>Ente
          <select id="ente" name="ENTE">
            <option value="">Seleziona ente</option>
          </select>
        </label>
        <div class="row">
          <div>
            <label>Data
              <input type="date" id="data" name="DATA" />
            </label>
          </div>
          <div>
            <label>Numero addetti
              <input type="number" id="addetti" name="ADDETTI" min="0" />
            </label>
          </div>
          <div>
            <label>Ore
              <input type="number" id="ore" name="ORE" min="0" />
            </label>
          </div>
        </div>
        <div class="row">
          <div><label>MQ sanificazione <input type="number" id="mq_sanificazione" name="MQ_SAN" min="0" /></label></div>
          <div><label>MQ disinfestazione <input type="number" id="mq_disinfestazione" name="MQ_DIS" min="0" /></label></div>
          <div><label>MQ derattizzazione <input type="number" id="mq_derattizzazione" name="MQ_DER" min="0" /></label></div>
        </div>
        <label>Note
          <textarea id="note" name="NOTE"></textarea>
        </label>
      </div>
    </div>

    <!-- riepilogo costi aggiornato -->
    <aside class="panel">
      <h3 style="margin-top:0">Riepilogo costi</h3>
      <div class="summary">
        <table aria-live="polite">
          <tbody>
            <tr><th>Subtotale</th><th class="right">€ <span id="subtotal">0.00</span></th></tr>
            <tr><td>IVA (22%)</td><td class="right">€ <span id="iva">0.00</span></td></tr>
            <tr><th>Totale</th><th class="right">€ <span id="total">0.00</span></th></tr>
          </tbody>
        </table>
        <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
          <button type="button" class="btn" id="calc">Calcola</button>
          <button type="button" class="btn secondary" id="reset">Reset</button>
        </div>
      </div>
      <div style="margin-top:14px">
        <label class="small">Operatore di struttura (firma)</label>
        <input id="operatoreFirma" name="OPERATORE_FIRMA" type="text" />
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end;">
        <button type="button" class="btn" id="print">Stampa / Salva PDF</button>
        <button type="button" class="btn secondary" id="exportJson">Esporta (JSON)</button>
      </div>
    </aside>

    <div class="full" style="margin-top:12px">
      <div class="muted">Versione web del modulo. I campi compilati possono essere stampati o esportati in JSON.</div>
    </div>

    <div class="firme-container">
      <div class="firma-canvas-container">
        <h3>Firma operatore</h3>
        <canvas id="firmaOperatore" class="firma-canvas"></canvas>
        <button type="button" class="btn secondary" onclick="pulisciFirma('firmaOperatore')">Pulisci firma</button>
      </div>
      <div class="firma-canvas-container">
        <h3>Firma cliente</h3>
        <canvas id="firmaCliente" class="firma-canvas"></canvas>
        <button type="button" class="btn secondary" onclick="pulisciFirma('firmaCliente')">Pulisci firma</button>
      </div>
    </div>
  </form>
</div>

<script>
  function pulisciFirma(id) {
    const canvas = document.getElementById(id);
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  document.getElementById("calc").addEventListener("click", function() {
    const addetti = +document.getElementById("addetti").value;
    const ore = +document.getElementById("ore").value;
    const mqSan = +document.getElementById("mq_sanificazione").value;
    const mqDis = +document.getElementById("mq_disinfestazione").value;
    const mqDer = +document.getElementById("mq_derattizzazione").value;

    const rateManut = 25;
    const ratePulizie = 20;
    const rateSan = 2;
    const rateDis = 4.5;
    const rateDer = 6.5;

    const costoOre = addetti * ore * (rateManut + ratePulizie);
    const costoSan = mqSan * rateSan;
    const costoDis = mqDis * rateDis;
    const costoDer = mqDer * rateDer;

    const subtotal = costoOre + costoSan + costoDis + costoDer;
    const iva = subtotal * 0.22;
    const total = subtotal + iva;

    document.getElementById("subtotal").innerText = subtotal.toFixed(2);
    document.getElementById("iva").innerText = iva.toFixed(2);
    document.getElementById("total").innerText = total.toFixed(2);
  });
</script>
</body>
</html>
