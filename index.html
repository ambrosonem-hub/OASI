<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modulo Ordine di Servizio — Web</title>
  <style>
    :root{--max-width:980px;--gap:12px;--accent:#0b67ff}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:#f5f7fb;color:#1f2937;padding:24px;display:flex;justify-content:center}
    .container{width:100%;max-width:var(--max-width);background:#fff;border-radius:12px;box-shadow:0 6px 24px rgba(20,30,60,0.08);padding:20px}
    h1{font-size:20px;margin:0 0 8px}
    p.lead{margin:0 0 18px;color:#475569}
    form{display:grid;grid-template-columns:1fr 320px;gap:18px}
    .panel{background:#fbfdff;border:1px solid #e6eefb;padding:12px;border-radius:8px}
    label{display:block;font-size:13px;font-weight:600;margin-bottom:6px}
    .field{margin-bottom:12px}
    select,input[type="text"],input[type="number"],textarea{width:100%;padding:8px;border:1px solid #d1d9e6;border-radius:6px;font-size:14px}
    textarea{min-height:80px;resize:vertical}
    .small{font-size:13px;color:#475569}
    .controls{display:flex;gap:8px;align-items:center}
    .full{grid-column:1/-1}
    .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn.secondary{background:#fff;color:var(--accent);border:1px solid #cfe0ff}
    .summary{background:#fff;padding:12px;border-radius:8px;border:1px solid #eef2ff}
    table{width:100%;border-collapse:collapse}
    td,th{padding:8px;text-align:left;border-bottom:1px solid #f1f5f9}
    .right{text-align:right}
    .muted{color:#6b7280;font-size:13px}
    .error{color:#b91c1c;font-weight:600}
    @media (max-width:900px){form{grid-template-columns:1fr;}}

/* Stile per il logo */
.logo-container {
  text-align: center;
  margin-bottom: 10px;
}
.logo-container img {
  max-width: 177px;
  max-height: 118px;
  height: auto;
}

/* Intestazione */
.header-info {
  text-align: center;
  font-size: 13px;
  line-height: 1.2;
  margin-bottom: 20px;
}
.header-info .title {
  font-size: 16px;
  font-weight: bold;
  margin-bottom: 5px;
}
.header-info div {
  margin: 0;
}


/* Stili per le firme */
.firma-canvas {
  border: 1px solid #000;
  cursor: crosshair;
  background-color: #fff;
  width: 300px;
  height: 150px;
}
.firma-canvas-container {
  margin-bottom: 15px;
}
.firme-container {
  display: flex;
  gap: 20px;
  justify-content: space-between;
  width: 100%;
}

/* Impostazioni per la stampa */
@media print {
  @page {
    size: A4 portrait;
    margin: 15mm;
  }

  body {
    padding: 0;
    background: #fff;
  }

  .container {
    max-width: 100%;
    box-shadow: none;
    border-radius: 0;
    padding: 10mm;
  }

  h1 { font-size: 16pt; }
  p.lead, label, .small, td, th, input, textarea, select {
    font-size: 11pt;
  }
  .btn, #calc, #reset, #exportJson, #print, .firma-canvas-container button {
    display: none !important;
  }
  .firma-canvas {
      border: 1px solid #000;
      width: 150px !important;
      height: 75px !important;
  }

  .firme-container {
    display: block;
  }

  .firma-canvas-container {
    page-break-inside: avoid;
    margin-top: 15px;
  }
}

/* Nascondi le tariffe nel riepilogo costi a destra */
.summary table tr:nth-child(-n+5) {
  display: none;
}
@media print {
  @page {
    size: A4 portrait;
    margin: 10mm;
  }
  body {
    transform: scale(1);
    transform-origin: top left;
    width: 100%;
    background: #fff;
    margin: 0;
    padding: 0;
  }
  .container {
    box-shadow: none;
    border-radius: 0;
  }
  .btn, #calc, #reset, #exportJson, #print {
    display: none !important;
  }
}
  </style>
</head>
<body>
<div class="container" role="main">
    <div class="logo-container">
        <img src="logo.jpg" alt="Logo Azienda" />
    </div>

    <div class="header-info">
      <div class="title">Sede Legale:</div>
      <div>Via Municipio, n. 14 - 83040 Fontanarosa (AV)</div>
      <div>Info – 082545553</div>
      <div>Mail - irpinialogistica@gmail.com</div>
      <div>PEC irpinialogistica@pec.it</div>
      <div>C.F. / Partita IVA 03196380640</div>
    </div>
    <h1 style="text-align:center;">ORDINE DI SERVIZIO</h1>
    <form id="moduloForm" autocomplete="off">
      <div>
        <div class="panel">
          <div class="field">
            <label for="progetto">Progetto</label>
            <select id="progetto" name="PROGETTO">
              <option value="SELEZIONARE">SELEZIONARE</option>
              <option value="SAI-A01">SAI-A01</option>
              <option value="SAI-A02">SAI-A02</option>
              <option value="SAI-A03">SAI-A03</option>
            </select>
            <div class="small muted">Seleziona il progetto per popolare Struttura ed Ente</div>
          </div>
          <div class="field">
            <label for="struttura">Struttura</label>
            <select id="struttura" name="STRUTTURA"><option>SELEZIONARE</option></select>
          </div>
          <div class="field">
            <label for="ente">Ente</label>
            <select id="ente" name="ENTE"><option>SELEZIONARE</option></select>
          </div>
          <div class="field">
            <label for="indirizzo">Indirizzo</label>
            <input id="indirizzo" name="INDIRIZZO" type="text" placeholder="Via, Piazza, etc." />
          </div>
          <div class="field">
            <label for="enteDaFatturare">Ente da fatturare</label>
            <input id="enteDaFatturare" name="ENTE_DA_FATTURARE" type="text" />
          </div>
          <div class="field">
            <label for="descrizione">Descrizione dei lavori</label>
            <textarea id="descrizione" name="DESCRIZIONE" placeholder="Descrivi il lavoro svolto..."></textarea>
<div class="small muted" style="margin-top:6px; white-space:pre-line;">
  Manutenzione (€/ora per operatore)  € 25.00
  Pulizie (€/ora per operatore)       € 20.00
  Sanificazione (€/mq)                € 2.00
  Disinfestazione (€/mq)              € 4.50
  Derattizzazione (€/mq)              € 6.50
</div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <div class="field">
              <label for="data">Data lavoro</label>
              <input id="data" name="DATA" type="date" />
            </div>
            <div class="field">
              <label for="operatori">Numero operatori</label>
              <input id="operatori" name="NUM_OPERATORI" type="number" min="0" step="1" value="1" />
            </div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <div class="field">
              <label for="totOre">Totale ore</label>
              <input id="totOre" name="TOT_ORE" type="number" min="0" step="0.5" value="0" />
            </div>
            <div class="field">
              <label for="mq">Metri quadrati (mq)</label>
              <input id="mq" name="MQ" type="number" min="0" step="0.1" value="0" />
            </div>
          </div>
          <div class="field">
            <label>Tipologia lavoro (seleziona le voci applicate)</label>
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <label><input type="checkbox" id="manutenzione_chk" name="MANUTENZIONE_CHECK"/> Manutenzione</label>
              <label><input type="checkbox" id="pulizie_chk" name="PULIZIE_CHECK"/> Servizio pulizie</label>
              <label><input type="checkbox" id="sanificazione_chk" name="SANIFICAZIONE_CHECK"/> Sanificazione</label>
              <label><input type="checkbox" id="disinfestazione_chk" name="DISINFESTAZIONE_CHECK"/> Disinfestazione</label>
              <label><input type="checkbox" id="derattizzazione_chk" name="DERATTIZZAZIONE_CHECK"/> Derattizzazione</label>
            </div>
            <div class="small muted">I costi vengono calcolati automaticamente in base ai campi inseriti.</div>
          </div>
        </div>
        <div class="panel" style="margin-top:12px">
          <label>Appunto sul lavoro svolto</label>
          <textarea id="appunto" name="APPUNTO" placeholder="Note aggiuntive..."></textarea>
<div class="small muted" style="margin-top:6px; white-space:pre-line;">
  Manutenzione (€/ora per operatore)  € 25.00
  Pulizie (€/ora per operatore)       € 20.00
  Sanificazione (€/mq)                € 2.00
  Disinfestazione (€/mq)              € 4.50
  Derattizzazione (€/mq)              € 6.50
</div>
        </div>
      </div>
      <aside class="panel">
        <h3 style="margin-top:0">Riepilogo costi</h3>
        <div class="summary">
          <table aria-live="polite">
            <tbody>
              <tr><td>Manutenzione (€/ora per operatore)</td><td class="right">€ <span id="rate_manutenzione">25.00</span></td></tr>
              <tr><td>Pulizie (€/ora per operatore)</td><td class="right">€ <span id="rate_pulizie">20.00</span></td></tr>
              <tr><td>Sanificazione (€/mq)</td><td class="right">€ <span id="rate_sanificazione">2.00</span></td></tr>
              <tr><td>Disinfestazione (€/mq)</td><td class="right">€ <span id="rate_disinfestazione">4.50</span></td></tr>
              <tr><td>Derattizzazione (€/mq)</td><td class="right">€ <span id="rate_derattizzazione">6.50</span></td></tr>
              <tr><th>Subtotale</th><th class="right">€ <span id="subtotal">0.00</span></th></tr>
              <tr><td>IVA (22%)</td><td class="right">€ <span id="iva">0.00</span></th></tr>
              <tr><th>Totale</th><th class="right">€ <span id="total">0.00</span></th></tr>
            </tbody>
          </table>
          <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
            <button type="button" class="btn" id="calc">Calcola</button>
            <button type="button" class="btn secondary" id="reset">Reset</button>
          </div>
        </div>
        <div style="margin-top:14px">
          <label class="small">Operatore di struttura (firma)</label>
          <input id="operatoreFirma" name="OPERATORE_FIRMA" type="text" />
        </div>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button type="button" class="btn" id="print">Stampa / Salva PDF</button>
          <button type="button" class="btn secondary" id="exportJson">Esporta (JSON)</button>
        </div>
      </aside>
      <div class="full" style="margin-top:12px">
        <div class="muted">Versione web del modulo. I campi compilati possono essere stampati o esportati in JSON.</div>
      </div>

<div class="firme-container">
    <div class="firma-canvas-container">
        <h3>Firma operatore</h3>
        <canvas id="firmaOperatore" class="firma-canvas"></canvas>
        <button type="button" onclick="pulisciFirma('firmaOperatore')">Pulisci firma</button>
    </div>
    <div class="firma-canvas-container">
        <h3>Firma cliente</h3>
        <canvas id="firmaCliente" class="firma-canvas"></canvas>
        <button type="button" onclick="pulisciFirma('firmaCliente')">Pulisci firma</button>
    </div>
</div>

</form>

</div>
  <script>
let dati = [];
fetch("enti_strutture.json")
  .then(response => response.json())
  .then(json => {
    dati = json;
    popolaProgetti();
  });
function popolaProgetti() {
  const progettoSelect = document.getElementById("progetto");
  if (!progettoSelect) return;
  const progettiUnici = [...new Set(dati.map(d => d.Progetto))];
  progettoSelect.innerHTML = "<option value=''>Seleziona progetto</option>";
  progettiUnici.forEach(p => {
    progettoSelect.innerHTML += `<option value="${p}">${p}</option>`;
  });
}
document.addEventListener("DOMContentLoaded", function() {
  const progettoEl = document.getElementById("progetto");
  const strutturaEl = document.getElementById("struttura");
  const enteEl = document.getElementById("ente");
  const indirizzoEl = document.getElementById("indirizzo");
  if (progettoEl) {
    progettoEl.addEventListener("change", e => {
      strutturaEl.innerHTML = "<option value=''>Seleziona struttura</option>";
      enteEl.innerHTML = "<option value=''>Seleziona ente</option>";
      indirizzoEl.value = "";
      const strutture = dati.filter(d => d.Progetto === e.target.value).map(d => d.Struttura);
      [...new Set(strutture)].forEach(s => {
        strutturaEl.innerHTML += `<option value="${s}">${s}</option>`;
      });
    });
  }
  if (strutturaEl) {
    strutturaEl.addEventListener("change", e => {
      const progettoVal = progettoEl.value;
      enteEl.innerHTML = "<option value=''>Seleziona ente</option>";
      const enti = dati.filter(d => d.Progetto === progettoVal && d.Struttura === e.target.value).map(d => d.Ente);
      [...new Set(enti)].forEach(en => {
        enteEl.innerHTML += `<option value="${en}">${en}</option>`;
      });
    });
  }
  if (enteEl) {
    enteEl.addEventListener("change", e => {
      const progettoVal = progettoEl.value;
      const strutturaVal = strutturaEl.value;
      const record = dati.find(d =>
        d.Progetto === progettoVal &&
        d.Struttura === strutturaVal &&
        d.Ente === e.target.value
      );
      indirizzoEl.value = record ? record.Indirizzo : "";
    });
  }
});
const RATES = {
  MANUTENZIONE: 25.00,
  PULIZIE: 20.00,
  SANIFICAZIONE: 2.00
